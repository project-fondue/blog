<!DOCTYPE html>
<html lang="en">
<head>
        
        <title>L'Alpiniste</title>
        <meta charset="utf-8" />
        
        <link href='http://fonts.googleapis.com/css?family=Fugaz+One' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="/theme/css/normalize.css" type="text/css" />
        <link rel="stylesheet" href="/theme/css/griddles-mq.css" type="text/css" />
        <link rel="stylesheet" href="/theme/css/style.css" type="text/css" />
</head>

<body>
    <div class="banner"></div>
    <div id="latest-tweet"></div>

    <div class="content-wrapper grid gutter">
        <section class="main g-3/4 m-g-100" role="main">
            <header>
                <a class="title" href="http://blog.projectfondue.com:9901">L'Alpiniste</a>
                <p><strong>The blog of the Project Fondue Team</strong></p>
            </header><!-- /#banner -->

            <nav id="menu">
                <ul>
                    
            
                
            
                </ul>
            </nav><!-- /#menu -->

            
    <header>
        <h1 class="entry-title"><a href="" rel="bookmark" title="Permalink to Loggerhead and mod_wsgi">Loggerhead and mod_wsgi</a></h1>
    </header>
    <div class="post-info">
        <abbr class="published" title="2009-11-27T09:14:00">
                Fri 27 November 2009
        </abbr>
        
        <p class="vcard author">
            By <a class="url fn" href="/author/Project Fondue Team">Project Fondue Team</a>
        </p>
        
    </div><!-- /.post-info -->
    <div class="entry-content">
    <p>We've recently started using Loggerhead for branch browsing as the redmine support for bazaar is a little lacking. We also wanted to provide a way to expose our open-source projects to the world.</p>
<p>Currently <a class="reference external" href="https://edge.launchpad.net/loggerhead">loggerhead</a> defaults to using pasteserver out of the box, which means you have to proxy this with Apache if you don't want to use pasteserver directly. Instead of doing that we went the route of setting up Loggerhead under apache with mod_wsgi.</p>
<p>Here's the wsgi file to set-up the application.</p>
<div class="highlight"><pre><span class="n">BZR_SERVE_DIR</span> <span class="o">=</span> <span class="s">&#39;THE_DIR_CONTAINING_YOUR_BRANCHES_HERE&#39;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">paste.httpexceptions</span> <span class="kn">import</span> <span class="n">HTTPExceptionHandler</span>
<span class="kn">from</span> <span class="nn">loggerhead.apps.transport</span> <span class="kn">import</span> <span class="n">BranchesFromTransportRoot</span>
<span class="kn">from</span> <span class="nn">loggerhead.apps.error</span> <span class="kn">import</span> <span class="n">ErrorHandlerApp</span>
<span class="kn">from</span> <span class="nn">loggerhead.config</span> <span class="kn">import</span> <span class="n">LoggerheadConfig</span>
<span class="kn">from</span> <span class="nn">paste.deploy.config</span> <span class="kn">import</span> <span class="n">PrefixMiddleware</span>
<span class="kn">from</span> <span class="nn">bzrlib.plugin</span> <span class="kn">import</span> <span class="n">load_plugins</span>

<span class="n">load_plugins</span><span class="p">()</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">LoggerheadConfig</span><span class="p">()</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">BranchesFromTransportRoot</span><span class="p">(</span><span class="n">BZR_SERVE_DIR</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">PrefixMiddleware</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">HTTPExceptionHandler</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">ErrorHandlerApp</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
<p>I save this file as loggerhead.wsgi in the checkout of loggerhead.</p>
<p>Next all you need is a basic apache config and a WSGIAlias directive pointing at the wsgi file. Obviously it goes without saying this example is just for illustrative purposes.</p>
<div class="highlight"><pre><span class="nt">&lt;VirtualHost</span> <span class="s">*:80</span><span class="nt">&gt;</span>
    <span class="nb">ServerName</span> loggerhead

    <span class="nb">WSGIScriptAlias</span> / <span class="sx">/PATH_TO_LOGGERHEAD/loggerhead.wsgi</span>

    <span class="nt">&lt;Directory</span> <span class="s">/PATH_TO_LOGGERHEAD</span><span class="nt">&gt;</span>
        <span class="nb">Order</span> allow,deny
        <span class="nb">Allow</span> from <span class="k">all</span>
    <span class="nt">&lt;/Directory&gt;</span>

<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">The following assumes you have a dns entry for whatever value you give ServerName - In my example I use loggerhead which I have set-up on my local machine to point to 127.0.0.1 so I have a local loggerhead running to view my checkouts.</p>
</div>
<ul class="simple">
<li>Change the values of the paths and the ServerName as necessary</li>
<li>Save this file as loggerhead (or whatever you want to call it) in /etc/apache2/sites-available</li>
</ul>
<p>Then all you need to do is enable it with</p>
<div class="highlight"><pre>sudo a2ensite loggerhead
sudo /etc/init.d/apache2 force-reload
</pre></div>
<p>That's it!</p>
<p>You can view our code repository at <a class="reference external" href="http://code.projectfondue.com/">http://code.projectfondue.com/</a> and a branch for these files is here: <a class="reference external" href="http://code.projectfondue.com/loggerhead-wsgi/trunk/files">http://code.projectfondue.com/loggerhead-wsgi/trunk/files</a></p>

    </div><!-- /.entry-content -->
    <div id="disqus_thread"></div>

        </section>

        
        <aside class="sidebar g-1/4 m-g-100">
            <h3><span>Feed your head</span></h3>
            <ul>
                <li><a href="http://twitter.com/projectfondue">Follow us on Twitter</a></li>
            </ul>

            <h3><span>Latest Posts</span></h3>
            <ul>
                
                <li><a href="/archives/2011/06/06/the-web-column-issue-no5">The Web Column: Issue No.5</a></li>
                
                <li><a href="/archives/2011/02/09/the-web-column-issue-no4">The Web Column: Issue No.4</a></li>
                
                <li><a href="/archives/2011/02/08/contribute-to-the-web-column">Contribute to the Web Column</a></li>
                
                <li><a href="/archives/2011/01/18/the-web-column-issue-no3">The Web Column: Issue No.3</a></li>
                
                <li><a href="/archives/2011/01/14/the-web-column-issue-no2">The Web Column: Issue No.2</a></li>
                
            </ul>

            

            <h3><span>Tags</span></h3>
            <ul class="tags">
                
                    <li class="tag-10"><a href="/tag/performance/">performance</a></li>
                
                    <li class="tag-10"><a href="/tag/accessibility/">accessibility</a></li>
                
                    <li class="tag-10"><a href="/tag/cron/">cron</a></li>
                
                    <li class="tag-1"><a href="/tag/web-column/">web-column</a></li>
                
                    <li class="tag-10"><a href="/tag/browsers/">browsers</a></li>
                
                    <li class="tag-10"><a href="/tag/scaling/">scaling</a></li>
                
                    <li class="tag-10"><a href="/tag/linux/">linux</a></li>
                
                    <li class="tag-10"><a href="/tag/restructuredtext/">restructuredtext</a></li>
                
                    <li class="tag-10"><a href="/tag/haproxy/">haproxy</a></li>
                
                    <li class="tag-2"><a href="/tag/python/">python</a></li>
                
                    <li class="tag-10"><a href="/tag/glusterfs/">glusterfs</a></li>
                
                    <li class="tag-10"><a href="/tag/css/">css</a></li>
                
                    <li class="tag-3"><a href="/tag/apache/">apache</a></li>
                
                    <li class="tag-6"><a href="/tag/wsgi/">wsgi</a></li>
                
                    <li class="tag-6"><a href="/tag/mod_wsgi/">mod_wsgi</a></li>
                
                    <li class="tag-10"><a href="/tag/nginx/">nginx</a></li>
                
                    <li class="tag-10"><a href="/tag/google/">google</a></li>
                
                    <li class="tag-10"><a href="/tag/announcements/">announcements</a></li>
                
                    <li class="tag-10"><a href="/tag/loggerhead/">loggerhead</a></li>
                
                    <li class="tag-10"><a href="/tag/devops/">devops</a></li>
                
            </ul>

            <h3><span>More Fondue</span></h3>
            <ul>
                <li><a href="http://spritegen.website-performance.org">CSS Sprite Generator</a></li>
                <li><a href="http://favicon-generator.org">Favicon Generator</a></li>
                <li><a href="http://permissions-calculator.org">Unix Permissions Calculator</a></li>
            </ul>


        </aside>
        
    </div>

    <footer id="contentinfo" class="body" role="contentinfo">
        <p class="powered">Proudly powered by <a href="http://docs.notmyidea.org/alexis/pelican/">pelican</a></p>
        <p class="copyright">&copy; Copyright 2008-2012 by <a href="http://projectfondue.com/">Project Fondue</a>.</p>
    </footer><!-- /#contentinfo -->

    

<script type="text/javascript">
    var disqus_shortname = 'projectfondue';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>


    <script src="/theme/js/lscache.js"></script>
    <script src="/theme/js/latest-tweet.js"></script>
</body>
</html>